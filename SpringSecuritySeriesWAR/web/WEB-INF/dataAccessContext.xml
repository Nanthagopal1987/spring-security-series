<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

    <!-- business stuff below -->
    <bean id="dataSource"
        class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" value="org.hsqldb.jdbcDriver" />
        <property name="url" value="jdbc:hsqldb:mem:test" />
        <property name="username" value="sa" />
        <property name="password" value="" />
    </bean>

    <bean id="transactionManager"
        class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource" />
    </bean>

    <!--
        ========= ACCESS CONTROL LIST LOOKUP MANAGER DEFINITIONS =========
    -->

    <bean id="aclCache"
        class="org.springframework.security.acls.jdbc.EhCacheBasedAclCache">
        <constructor-arg>
            <bean class="org.springframework.cache.ehcache.EhCacheFactoryBean">
                <property name="cacheManager">
                    <bean class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean" />
                </property>
                <property name="cacheName" value="aclCache" />
            </bean>
        </constructor-arg>
    </bean>
    
    <bean id="aclAuthorizationStrategy" class="org.springframework.security.acls.domain.AclAuthorizationStrategyImpl">
        <constructor-arg>
            <list>
                <!-- authority for taking ownership -->
                <bean class="org.springframework.security.GrantedAuthorityImpl">
                    <constructor-arg value="ROLE_ADMIN"/>
                </bean>
                <!-- authority to modify auditing -->
                <bean class="org.springframework.security.GrantedAuthorityImpl">
                    <constructor-arg value="ROLE_ADMIN"/>
                </bean>
                <!-- authority to make general changes -->
                <bean class="org.springframework.security.GrantedAuthorityImpl">
                    <constructor-arg value="ROLE_ADMIN"/>
                </bean>
            </list>
        </constructor-arg>
    </bean>
    

    <bean id="lookupStrategy"
        class="org.springframework.security.acls.jdbc.BasicLookupStrategy">
        <constructor-arg ref="dataSource" />
        <constructor-arg ref="aclCache" />
        <constructor-arg ref="aclAuthorizationStrategy" />
        <constructor-arg>
            <bean class="org.springframework.security.acls.domain.ConsoleAuditLogger" />
        </constructor-arg>
    </bean>

    <bean id="aclService"
        class="org.springframework.security.acls.jdbc.JdbcMutableAclService">
        <constructor-arg ref="dataSource" />
        <constructor-arg ref="lookupStrategy" />
        <constructor-arg ref="aclCache" />
    </bean>

    <bean id="dataSourcePopulator" class="com.heraclitus.service.HsqldbSchemaAndDataPopulator">
        <property name="dataSource" ref="dataSource" />
        <property name="mutableAclService" ref="aclService" />
        <property name="platformTransactionManager" ref="transactionManager" />
    </bean>
    
    <bean id="projectDao" class="com.heraclitus.dao.springjdbc.ProjectDaoSpringJDBC">
        <property name="dataSource" ref="dataSource" />
    </bean>

    <bean id="projectService" class="com.heraclitus.service.impl.ProjectServiceImpl">
        <property name="projectDao" ref="projectDao" />
    </bean>

     <!-- ACL Specific dao's and services -->
    <bean id="aclSidDao" class="com.heraclitus.dao.acl.springjdbc.AclSidDaoSpringJDBC">
        <property name="dataSource" ref="dataSource" />
    </bean>

    <bean id="aclClassDao" class="com.heraclitus.dao.acl.springjdbc.AclClassDaoSpringJDBC">
        <property name="dataSource" ref="dataSource" />
    </bean>

    <bean id="aclObjectIdentityDao" class="com.heraclitus.dao.acl.springjdbc.AclObjectIdentityDaoSpringJDBC">
        <property name="dataSource" ref="dataSource" />
    </bean>

    <bean id="aclEntryDao" class="com.heraclitus.dao.acl.springjdbc.AclEntryDaoSpringJDBC">
        <property name="dataSource" ref="dataSource" />
    </bean>

    <bean id="aclQueryService" class="com.heraclitus.service.impl.AclQueryServiceImpl">
        <property name="aclSidDao" ref="aclSidDao" />
        <property name="aclClassDao" ref="aclClassDao" />
        <property name="aclObjectIdentityDao" ref="aclObjectIdentityDao" />
        <property name="aclEntryDao" ref="aclEntryDao" />
    </bean>
</beans>
